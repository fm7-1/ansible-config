---

- name: Ensure the Code directory exist
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/Code"
    state: directory
    mode: "0700"

#- name: Checkout dotfiles repository
#  ansible.builtin.git:
#    repo: "git@github.com:{{ dotfiles_repo }}"
#    dest: "{{ ansible_env.HOME }}/Code/dotfiles"

- name: Find stow packages
  ansible.builtin.find:
    paths: "{{ ansible_env.HOME }}/Code/dotfiles"
    file_type: directory
    use_regex: yes
  register: stow_packages

- name: Create list of stow packages
  ansible.builtin.set_fact:
    "stow_pkgs" : "{{ stow_packages.files | map(attribute='path') | list  }}"

- name: Debug 
  debug:
    msg: "{{ item | basename }}"
  with_items: "{{ stow_pkgs }}" 
